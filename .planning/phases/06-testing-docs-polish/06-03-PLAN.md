---
phase: 06-testing-docs-polish
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - composer.json
  - config/scramble.php
  - app/Http/Controllers/Api/AuthController.php
  - app/Http/Controllers/Api/InvoiceController.php
  - README.md
autonomous: true
requirements: [INFR-05, DEVP-03, DEVP-04]

must_haves:
  truths:
    - "OpenAPI 3.x spec is accessible at /docs/api endpoint"
    - "API documentation reflects all endpoints with request/response schemas"
    - "README has badges (build, Laravel, PHP, license)"
    - "README has architecture overview describing the async pipeline"
    - "README has curl examples for login, upload, list, show, download, delete"
    - "README has setup instructions (Docker, env, migrate, seed)"
    - "README documents all environment variables"
  artifacts:
    - path: "config/scramble.php"
      provides: "Scramble configuration"
    - path: "README.md"
      provides: "Professional README"
      min_lines: 100
  key_links:
    - from: "config/scramble.php"
      to: "routes/api.php"
      via: "Scramble auto-discovers routes"
      pattern: "api_path|prefix"
    - from: "README.md"
      to: "docker-compose.yml"
      via: "Setup instructions reference Docker commands"
      pattern: "docker.compose"
---

<objective>
Install dedoc/scramble for auto-generated OpenAPI documentation and create a professional README with badges, architecture overview, curl examples, and setup instructions.

Purpose: Satisfy INFR-05 (OpenAPI 3.x via scramble), DEVP-03 (README with badges, architecture, curl examples), and DEVP-04 (README with setup instructions and env docs).
Output: Working /docs/api endpoint with OpenAPI spec, polished README.md.
</objective>

<execution_context>
@/Users/valerijbakalenko/.claude/get-shit-done/workflows/execute-plan.md
@/Users/valerijbakalenko/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@routes/api.php
@docker-compose.yml
@.env.example
@composer.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure dedoc/scramble for OpenAPI docs</name>
  <files>composer.json, config/scramble.php, app/Http/Controllers/Api/AuthController.php, app/Http/Controllers/Api/InvoiceController.php</files>
  <action>
1. Install scramble: `docker compose exec app composer require dedoc/scramble` (it's a runtime dependency — serves docs endpoint).

2. Publish config: `docker compose exec app php artisan vendor:publish --provider="Dedoc\Scramble\ScrambleServiceProvider" --tag="scramble-config"`

3. Edit config/scramble.php:
   - Set `'api_path' => 'api/v1'` so Scramble discovers routes under /api/v1/
   - Set `'api_domain' => null` (default)

4. Add PHPDoc return types and @response annotations to controller methods where Scramble needs help inferring response shapes. Specifically:
   - AuthController::login — add `@return \Illuminate\Http\JsonResponse` (already has it, verify)
   - InvoiceController::upload — ensure return type hint is JsonResponse
   - InvoiceController methods already have return types, but add brief `/** */` docblocks if missing for Scramble to pick up response resources

5. Verify docs are accessible: `docker compose exec app php artisan route:list | grep scramble` to confirm the /docs/api route is registered.

6. Test that OpenAPI JSON is generated: `curl http://localhost/docs/api.json` (or equivalent based on the Docker Nginx setup) returns valid JSON with openapi: "3.x.x" key.

Note: Scramble automatically infers response schemas from Resource classes (InvoiceResource, UserResource, InvoiceItemResource) and FormRequest validation rules. No manual schema definitions needed.
  </action>
  <verify>Run `docker compose exec app php artisan route:list --path=docs` shows scramble routes. Access /docs/api in browser or curl returns HTML documentation page.</verify>
  <done>Scramble installed, configured for /api/v1/ routes, docs accessible at /docs/api with OpenAPI 3.x spec.</done>
</task>

<task type="auto">
  <name>Task 2: Create professional README with badges, architecture, examples, and setup docs</name>
  <files>README.md</files>
  <action>
Replace the default Laravel README.md with a professional project README. Structure:

**Header section:**
- Project title: "Invoice Parser API"
- One-line description: "A Laravel microservice that parses PDF invoices using OpenAI GPT-4o Vision and returns structured JSON data"
- Badges (use shields.io): Laravel 11, PHP 8.3, OpenAI GPT-4o, License MIT

**Features section** (bullet list):
- PDF upload with async processing
- AI-powered data extraction (vendor, customer, line items, totals)
- Confidence scoring for extracted fields
- RESTful CRUD with pagination and filtering
- Token-based authentication (Sanctum)
- Auto-generated OpenAPI documentation

**Architecture section:**
- Brief text describing the async pipeline: Upload -> Queue -> ConvertPdfToImages -> ParseInvoiceWithAI -> SaveParsedData -> CleanupTempFiles
- Tech stack list: Laravel 11, PHP 8.3, MySQL 8, Redis, Nginx, Docker
- Mention GPT-4o Vision with Structured Outputs for reliable JSON extraction

**Quick Start section:**
```bash
git clone <repo>
cd invoice-parser-api
cp .env.example .env
# Set OPENAI_API_KEY in .env
docker compose up -d
docker compose exec app php artisan key:generate
docker compose exec app php artisan migrate
docker compose exec app php artisan db:seed
```

**API Usage section** with curl examples:
1. Login: `curl -X POST http://localhost/api/v1/login -H "Content-Type: application/json" -d '{"email":"test@example.com","password":"password"}'`
2. Upload invoice: `curl -X POST http://localhost/api/v1/invoices -H "Authorization: Bearer {token}" -F "pdf=@invoice.pdf"`
3. List invoices: `curl http://localhost/api/v1/invoices -H "Authorization: Bearer {token}"`
4. Show invoice: `curl http://localhost/api/v1/invoices/1 -H "Authorization: Bearer {token}"`
5. Download PDF: `curl http://localhost/api/v1/invoices/1/download -H "Authorization: Bearer {token}" -o invoice.pdf`
6. Delete invoice: `curl -X DELETE http://localhost/api/v1/invoices/1 -H "Authorization: Bearer {token}"`

**Environment Variables section:**
Table with columns: Variable, Description, Default
- APP_KEY: Application encryption key (generated)
- DB_HOST, DB_PORT, DB_DATABASE, DB_USERNAME, DB_PASSWORD: MySQL config (defaults from docker-compose)
- REDIS_HOST: Redis host (redis)
- QUEUE_CONNECTION: Queue driver (redis)
- OPENAI_API_KEY: OpenAI API key (required, no default)
- OPENAI_ORGANIZATION: OpenAI org ID (optional)

**API Documentation section:**
- Note that OpenAPI docs are available at /docs/api when the app is running

**Testing section:**
```bash
docker compose exec app php artisan test
```

**License section:** MIT

Read .env.example to get the accurate list of env vars and their defaults before writing.
  </action>
  <verify>Read the created README.md and verify it contains: badges, architecture description, all 6 curl examples, setup instructions with docker compose commands, environment variables table, and testing section.</verify>
  <done>README.md is professional, contains badges, architecture overview, curl examples for all endpoints, complete setup instructions, env var documentation, and API docs reference.</done>
</task>

</tasks>

<verification>
- /docs/api endpoint returns OpenAPI documentation page
- /docs/api.json returns valid OpenAPI 3.x JSON
- README.md contains all required sections: badges, architecture, curl examples, setup, env vars
- README curl examples use correct endpoint paths (/api/v1/...)
</verification>

<success_criteria>
- Scramble installed and serving OpenAPI docs at /docs/api
- README has shields.io badges for Laravel, PHP, OpenAI, License
- README has architecture overview with async pipeline description
- README has 6 curl examples covering full API workflow
- README has docker compose setup instructions
- README has environment variables table with all required vars
</success_criteria>

<output>
After completion, create `.planning/phases/06-testing-docs-polish/06-03-SUMMARY.md`
</output>
